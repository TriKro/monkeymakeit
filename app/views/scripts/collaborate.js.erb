try {

  function collaborate_lightbox_<%= @unique_code %>() {

    try {
      var maxCrossBrowserZIndex = 2147483647;         /* from http://softwareas.com/whats-the-maximum-z-index */

      var width = document.documentElement.clientWidth + document.documentElement.scrollLeft;

      var layer = document.createElement('div');
      layer.style.zIndex = maxCrossBrowserZIndex - 1;
      layer.id = 'layer';
      layer.style.position = 'absolute';
      layer.style.top = '0px';
      layer.style.left = '0px';
      layer.style.height = document.documentElement.scrollHeight + 'px';
      layer.style.width = width + 'px';
      layer.style.backgroundColor = 'black';
      layer.style.opacity = '.6';
      layer.style.filter += ("progid:DXImageTransform.Microsoft.Alpha(opacity=60)");
      document.body.appendChild(layer);

      var box = document.createElement('div');
      box.style.zIndex = maxCrossBrowserZIndex;
      box.id = 'box';
      box.style.position = 'fixed';
      box.style.top = '100px';
      box.style.left = (width / 2) - (600 / 2) + 'px';
      box.style.height = '500px';
      box.style.width = '600px';
      box.style.margin = '0 auto';
      box.style.border = '7px solid #00b7fb';
      box.style.backgroundColor = '#e6e6e6';
      document.body.appendChild(box);

      var spinner = document.createElement('img');
      spinner.id = 'spinner';
      spinner.src = '<%= root_url %>images/spinner.gif';
      spinner.style.position = 'absolute';
      spinner.style.top = '220px';
      spinner.style.left = '260px';
      spinner.style.zIndex = -1;
      box.appendChild(spinner);

      var iframe_span = document.createElement('span');

      <% page_to_tweak = params[ :demo ] ? 'http://grasshopperherder.com/' : "' + window.location + '" %>
      <% iframe_source = new_signup_url( params.slice( :demo, :code ).merge( :button_id => @button.id ) ) %>
      <% iframe_source += "&url=#{page_to_tweak}" %>

      var iframe = '<iframe src="<%= iframe_source %>" ' +
              'bordercolor="#000000" vspace="0" hspace="0" marginheight="0" marginwidth="0" style="padding: 0pt; margin: 0pt;" ' +
              'allowtransparency="true" id="lightbox_iframe_<%= @unique_code %>" frameborder="0" width="100%" height="500px" scrolling="no" ></iframe>';
      iframe_span.innerHTML = iframe;
      box.appendChild(iframe_span);


      var close = document.createElement('a');
      close.id = 'close_button';
      close.innerHTML = '<img src="<%= root_url %>images/button-closethisoverlay_overdown.png"/>';
      close.style.position = 'absolute';
      close.style.top = '2px';
      close.style.right = '2px';
      close.href = 'javascript:void(0)';
      close.onclick = function() {
        document.body.removeChild(document.getElementById('layer'));
        document.body.removeChild(document.getElementById('box'));
      };

      box.appendChild(close);

    } catch(e) {
    <% if Rails.env.development? %>
      alert('Javascript error: ' + e.message)
    <% end %>
    }
  }

  <% document_write = !( params[:document_write] == 'false' ) %>
  <% if document_write %>
    document.write(
            '<style type="text/css">' +
            '#monkeymakeit_button {' +
            '  background: url(<%= root_url %>images/widget_buttons/<%= @button.button_name %>) no-repeat 0px 0px;' +
            '  display: inline-block;' +
            '  width: <%= @button.button_width %>px;' +
            '  height: <%= @button.button_height %>px;' +
            '}' +
            '#monkeymakeit_button:hover {' +
            '  background-position: 0 -<%= @button.button_height %>px;' +
            '}' +
            '</style>' +
            '<a href="javascript:void(collaborate_lightbox_<%= @unique_code %>());"' +
            '  style="border-bottom: none !important; text-decoration: none;">' +
            '    <span id="monkeymakeit_button"></span>' +
            '</a>');
  <% end %>

} catch(e) {
  <% if Rails.env.development? %>
    alert('Javascript error: ' + e.message)
  <% end %>
}
